<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bucket Viewer - å­˜å‚¨æ¡¶æŸ¥çœ‹å™¨</title>
  <link rel="stylesheet" href="viewer.css">
  <!-- PDFé¢„è§ˆç°åœ¨ä½¿ç”¨è½»é‡çº§æ–¹æ¡ˆï¼Œæ— éœ€åŠ è½½PDF.jsåº“ -->
</head>
<body>
  <div class="app-container">
    <!-- é¡¶éƒ¨åŠŸèƒ½åŒºåŸŸ -->
    <div class="top-features">
      <!-- å·¦ä¾§ï¼šURLè¾“å…¥å’Œå†å²è®°å½• - åœ¨åŒä¸€ä¸ªç™½å—å†… -->
      <div class="left-features">
        <div class="url-section">
          <!-- å­˜å‚¨æ¡¶è§£æè¾“å…¥åŒºåŸŸ -->
          <div class="section-part">
            <div class="section-header">
              <span class="section-icon">ğŸ”</span>
              <span class="section-title">å­˜å‚¨æ¡¶è§£æ</span>
            </div>
            <div class="section-content">
              <!-- ä¸»è¾“å…¥åŒºåŸŸ -->
              <div class="main-input-area">
                <div class="input-group">
                  <input
                    type="url"
                    id="bucketUrlInput"
                    placeholder="è¾“å…¥å­˜å‚¨æ¡¶URLï¼Œä¾‹å¦‚ï¼šhttp://minio.example.com/bucket/"
                    class="url-input"
                    autocomplete="off"
                  >
                  <button class="btn btn-primary" id="parseUrlBtn">
                    <span class="icon">ğŸ”</span>
                    è§£æå­˜å‚¨æ¡¶
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- åˆ†éš”çº¿ -->
          <div class="section-divider"></div>

          <!-- ä¸­é—´åŒºåŸŸï¼šå·¦ä¾§ç©ºç™½ -->
          <div class="section-part middle-part">
            <!-- è¿™é‡Œæ˜¯ç©ºç™½åŒºåŸŸï¼Œç”¨äºä¸å³ä¾§çš„æ–‡ä»¶é€‰æ‹©åŒºåŸŸå¯¹é½ -->
            <div class="empty-area">
              <span class="empty-text">é¢„ç•™åŒºåŸŸ</span>
            </div>
          </div>

          <!-- åˆ†éš”çº¿ -->
          <div class="section-divider"></div>

          <!-- æœ€è¿‘è§£æå†å²åŒºåŸŸ -->
          <div class="section-part">
            <div class="section-header">
              <span class="section-icon">ğŸ“œ</span>
              <span class="section-title">æœ€è¿‘è§£æ</span>
            </div>
            <div class="section-content">
              <div class="history-list" id="historyList">
                <div class="history-empty">æš‚æ— å†å²è®°å½•</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- å³ä¾§ï¼šPUTè¦†ç›–åŠŸèƒ½ - åœ¨åŒä¸€ä¸ªç™½å—å†… -->
      <div class="right-features">
        <div class="put-section">
          <!-- PUTè¦†ç›–è¾“å…¥åŒºåŸŸ -->
          <div class="section-part">
            <div class="section-header">
              <span class="section-icon">ğŸ”§</span>
              <span class="section-title">PUTæ–‡ä»¶è¦†ç›–</span>
            </div>
            <div class="section-content">
              <!-- è¦†ç›–è·¯å¾„è¾“å…¥ -->
              <div class="input-group">
                <input
                  type="text"
                  id="overridePathInput"
                  placeholder="è¾“å…¥è¦†ç›–è·¯å¾„ï¼Œä¾‹å¦‚ï¼šimages/avatar.jpg"
                  class="override-path-input"
                >
                <button class="btn btn-secondary" id="detectPutPermissionBtn">
                  <span class="icon">ğŸ”</span>
                  æ£€æµ‹æƒé™
                </button>
              </div>

              <!-- çŠ¶æ€æ˜¾ç¤ºåŒºåŸŸ -->
              <div id="putDetectionResult" class="detection-result hidden">
                <!-- åŠ¨æ€å†…å®¹ï¼šæ£€æµ‹çŠ¶æ€ã€ç»“æœç­‰ -->
              </div>
            </div>
          </div>

          <!-- åˆ†éš”çº¿ -->
          <div class="section-divider"></div>

          <!-- æ–‡ä»¶é€‰æ‹©å’Œä¸Šä¼ åŒºåŸŸ -->
          <div class="section-part middle-part">
            <div class="section-header">
              <span class="section-icon">ğŸ“</span>
              <span class="section-title">é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶</span>
            </div>
            <div class="section-content">
              <div class="file-input-group">
                <input
                  type="file"
                  id="overrideFileInput"
                  class="file-input"
                  accept="image/*,.json,.txt,.pdf,.doc,.docx,.xls,.xlsx"
                >
                <label for="overrideFileInput" class="file-input-label">
                  <span class="file-input-icon">ğŸ“</span>
                  <span class="file-input-text" id="fileInputText">é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶</span>
                </label>
                <button class="btn btn-primary" id="uploadOverrideBtn">
                  <span class="icon">â¬†ï¸</span>
                  ä¸Šä¼ è¦†ç›–
                </button>
              </div>
              <div class="file-info" id="selectedFileInfo" style="display: none;">
                <span class="file-name" id="selectedFileName"></span>
                <span class="file-size" id="selectedFileSize"></span>
              </div>
            </div>
          </div>

          <!-- åˆ†éš”çº¿ -->
          <div class="section-divider"></div>

          <!-- æ“ä½œå†å²åŒºåŸŸ -->
          <div class="section-part">
            <div class="section-header">
              <span class="section-icon">ğŸ“‹</span>
              <span class="section-title">æ“ä½œå†å²</span>
            </div>
            <div class="section-content">
              <div class="history-list" id="putHistoryList">
                <div class="history-empty">æš‚æ— æ“ä½œè®°å½•</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- å­˜å‚¨æ¡¶ä¿¡æ¯åŒºåŸŸ -->
    <div class="bucket-info hidden" id="bucketInfo">
      <span class="bucket-url" id="bucketUrl">åŠ è½½ä¸­...</span>
      <span class="file-count" id="fileCount">0 ä¸ªæ–‡ä»¶</span>
      <div class="bucket-actions">
        <button class="btn btn-secondary hidden" id="refreshBtn" title="åˆ·æ–°æ•°æ®">
          <span class="icon">ğŸ”„</span>
        </button>
        <button class="btn btn-secondary hidden" id="loadAllBtn" title="åŠ è½½å…¨éƒ¨æ•°æ®">
          <span class="icon">â¬‡ï¸</span> åŠ è½½å…¨éƒ¨
        </button>
        <button class="btn btn-secondary hidden" id="exportBtn" title="å¯¼å‡ºæ•°æ®">
          <span class="icon">ğŸ“¥</span>
        </button>
      </div>

      <!-- åˆ†é¡µæ§åˆ¶åŒºåŸŸ -->
      <div class="pagination-controls hidden" id="paginationControls">
        <div class="pagination-info">
          <span id="paginationStatus">æ˜¾ç¤ºç¬¬ 1-1000 æ¡</span>
          <span class="pagination-total" id="paginationTotal">å…± 0 æ¡</span>
        </div>
        <div class="pagination-buttons">
          <button class="btn btn-sm" id="firstPageBtn" title="é¦–é¡µ">
            <span class="icon">â®ï¸</span>
          </button>
          <button class="btn btn-sm" id="prevPageBtn" title="ä¸Šä¸€é¡µ">
            <span class="icon">â—€ï¸</span>
          </button>
          <div class="page-jump">
            <input type="number" id="pageJumpInput" class="page-input" min="1" value="1" title="è·³è½¬åˆ°æŒ‡å®šé¡µé¢">
            <span>/</span>
            <span id="totalPages">1</span>
          </div>
          <button class="btn btn-sm" id="nextPageBtn" title="ä¸‹ä¸€é¡µ">
            <span class="icon">â–¶ï¸</span>
          </button>
          <button class="btn btn-sm" id="lastPageBtn" title="æœ«é¡µ">
            <span class="icon">â­ï¸</span>
          </button>
        </div>
        <div class="pagination-actions">
          <select id="batchLoadSize" class="batch-select" title="æ‰¹é‡åŠ è½½é¡µæ•°">
            <option value="1">åŠ è½½1é¡µ</option>
            <option value="5">åŠ è½½5é¡µ</option>
            <option value="10" selected>åŠ è½½10é¡µ</option>
            <option value="50">åŠ è½½50é¡µ</option>
            <option value="all">åŠ è½½å…¨éƒ¨</option>
          </select>
          <button class="btn btn-primary" id="batchLoadBtn" title="æ‰¹é‡åŠ è½½">
            <span class="icon">â¬‡ï¸</span>
            æ‰¹é‡åŠ è½½
          </button>
        </div>
      </div>
    </div>

    <!-- Toolbar -->
    <div class="toolbar">
      <div class="toolbar-left">
        <!-- è§†å›¾åˆ‡æ¢ -->
        <div class="view-switcher">
          <button class="view-btn active" data-view="grid" title="ç½‘æ ¼è§†å›¾">
            <span class="icon">âŠ</span>
          </button>
          <button class="view-btn" data-view="list" title="åˆ—è¡¨è§†å›¾">
            <span class="icon">â˜°</span>
          </button>
        </div>

        <!-- æ–‡ä»¶ç±»å‹è¿‡æ»¤ -->
        <div class="filter-group">
          <select id="categoryFilter" class="filter-select">
            <option value="">æ‰€æœ‰ç±»å‹</option>
            <option value="images">å›¾ç‰‡</option>
            <option value="documents">æ–‡æ¡£</option>
            <option value="videos">è§†é¢‘</option>
            <option value="audio">éŸ³é¢‘</option>
            <option value="archives">å‹ç¼©åŒ…</option>
            <option value="others">å…¶ä»–</option>
          </select>
        </div>

        <!-- æœç´¢ -->
        <div class="search-group">
          <input
            type="text"
            id="searchInput"
            placeholder="æœç´¢æ–‡ä»¶å..."
            class="search-input"
          >
          <button class="search-btn" id="searchBtn">
            <span class="icon">ğŸ”</span>
          </button>
        </div>
      </div>

      <div class="toolbar-right">
        <!-- æ’åº -->
        <div class="sort-group">
          <select id="sortBy" class="sort-select">
            <option value="name">æŒ‰åç§°</option>
            <option value="size">æŒ‰å¤§å°</option>
            <option value="modified">æŒ‰ä¿®æ”¹æ—¶é—´</option>
            <option value="type">æŒ‰ç±»å‹</option>
          </select>
          <button class="sort-order-btn" id="sortOrderBtn" title="æ’åºæ–¹å‘">
            <span class="icon">â†‘</span>
          </button>
        </div>

        <!-- åˆ†é¡µä¿¡æ¯ -->
        <div class="pagination-info">
          <span id="paginationInfo">æ˜¾ç¤º 0-0 æ¡ï¼Œå…± 0 æ¡</span>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Loading State -->
      <div id="loadingState" class="loading-state">
        <div class="loading-spinner"></div>
        <p class="loading-text">æ­£åœ¨åŠ è½½å­˜å‚¨æ¡¶æ•°æ®...</p>
        <div class="loading-progress">
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
          </div>
          <span class="progress-text" id="progressText">0%</span>
        </div>
      </div>

      <!-- Empty State -->
      <div id="emptyState" class="empty-state hidden">
        <div class="empty-icon">ğŸ“</div>
        <h3>æ²¡æœ‰æ‰¾åˆ°æ–‡ä»¶</h3>
        <p>è¯¥å­˜å‚¨æ¡¶ä¸­æ²¡æœ‰æ–‡ä»¶æˆ–æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶ã€‚</p>
      </div>

      <!-- Error State -->
      <div id="errorState" class="error-state hidden">
        <div class="error-icon">âš ï¸</div>
        <h3>åŠ è½½å¤±è´¥</h3>
        <p id="errorMessage">åŠ è½½å­˜å‚¨æ¡¶æ•°æ®æ—¶å‘ç”Ÿé”™è¯¯ã€‚</p>
        <button class="btn btn-primary" id="retryBtn">é‡è¯•</button>
      </div>

      <!-- Grid View -->
      <div id="gridView" class="grid-view hidden">
        <div class="file-grid" id="fileGrid">
          <!-- æ–‡ä»¶ç½‘æ ¼å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
        </div>
      </div>

      <!-- List View -->
      <div id="listView" class="list-view hidden">
        <div class="file-list-container">
          <table class="file-list" id="fileList">
            <thead>
              <tr>
                <th class="sortable" data-sort="name">åç§°</th>
                <th class="sortable" data-sort="size">å¤§å°</th>
                <th class="sortable" data-sort="modified">ä¿®æ”¹æ—¶é—´</th>
                <th class="sortable" data-sort="type">ç±»å‹</th>
                <th>æ“ä½œ</th>
              </tr>
            </thead>
            <tbody id="fileListBody">
              <!-- æ–‡ä»¶åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </tbody>
          </table>
        </div>
      </div>
    </main>

    <!-- Pagination -->
    <div class="pagination" id="pagination">
      <button class="page-btn" id="firstPageBtn" title="é¦–é¡µ">
        <span class="icon">â®</span>
      </button>
      <button class="page-btn" id="prevPageBtn" title="ä¸Šä¸€é¡µ">
        <span class="icon">â—€</span>
      </button>
      <div class="page-numbers" id="pageNumbers">
        <!-- é¡µç å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
      </div>
      <button class="page-btn" id="nextPageBtn" title="ä¸‹ä¸€é¡µ">
        <span class="icon">â–¶</span>
      </button>
      <button class="page-btn" id="lastPageBtn" title="æœ«é¡µ">
        <span class="icon">â­</span>
      </button>
    </div>
  </div>

  <!-- Image Preview Modal -->
  <div id="imagePreviewModal" class="modal hidden">
    <div class="modal-backdrop" id="modalBackdrop"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="previewTitle">å›¾ç‰‡é¢„è§ˆ</h3>
        <button class="modal-close" id="modalClose">
          <span class="icon">âœ•</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="image-preview-container">
          <img id="previewImage" src="" alt="é¢„è§ˆå›¾ç‰‡" class="preview-image">
          <div class="preview-controls">
            <button class="preview-btn" id="zoomInBtn" title="æ”¾å¤§">
              <span class="icon">ğŸ”</span>
            </button>
            <button class="preview-btn" id="zoomOutBtn" title="ç¼©å°">
              <span class="icon">ğŸ”</span>
            </button>
            <button class="preview-btn" id="downloadBtn" title="ä¸‹è½½">
              <span class="icon">ğŸ“¥</span>
            </button>
            <button class="preview-btn" id="prevImageBtn" title="ä¸Šä¸€å¼ ">
              <span class="icon">â—€</span>
            </button>
            <button class="preview-btn" id="nextImageBtn" title="ä¸‹ä¸€å¼ ">
              <span class="icon">â–¶</span>
            </button>
          </div>
        </div>
        <div class="image-info">
          <p id="imageInfo">æ–‡ä»¶ä¿¡æ¯</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Download Progress Modal -->
  <div id="downloadModal" class="modal hidden">
    <div class="modal-backdrop"></div>
    <div class="modal-content download-modal">
      <div class="modal-header">
        <h3>ä¸‹è½½è¿›åº¦</h3>
      </div>
      <div class="modal-body">
        <div class="download-list" id="downloadList">
          <!-- ä¸‹è½½è¿›åº¦å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="closeDownloadBtn">å…³é—­</button>
      </div>
    </div>
  </div>

  <script src="viewer.js"></script>

<!-- Debug Script -->
<script>
  // ç­‰å¾…é¡µé¢å®Œå…¨åŠ è½½åæ·»åŠ è°ƒè¯•å‡½æ•°
  setTimeout(() => {
    console.log('[Debug] Adding simple debug functions...');

    // ç®€å•çš„è°ƒè¯•å‡½æ•°
    window.debugCheck = function() {
      console.log('=== SIMPLE DEBUG ===');
      console.log('window.viewer:', !!window.viewer);
      console.log('window.bucketViewer:', !!window.bucketViewer);

      const viewer = window.viewer || window.bucketViewer;
      if (viewer) {
        console.log('Files loaded:', viewer.files.length);
        console.log('Has more pages:', viewer.hasMorePages);
        console.log('Max keys:', viewer.maxKeys);

        // æ˜¾ç¤ºæŒ‰é’®ï¼ˆç°åœ¨é»˜è®¤æ€»æ˜¯æ˜¾ç¤ºï¼‰
        console.log('Showing load all button (always visible now)...');
        viewer.showLoadAllButton();
      } else {
        console.log('Viewer not found, trying to access BucketViewer class...');
        if (typeof BucketViewer !== 'undefined') {
          console.log('BucketViewer class found, viewer may be initializing...');
        }
      }
    };

    // å¼ºåˆ¶æ˜¾ç¤ºæŒ‰é’®
    window.forceShowButton = function() {
      console.log('Showing load all button (always visible)...');
      const viewer = window.viewer || window.bucketViewer;
      if (viewer) {
        viewer.showLoadAllButton();
        console.log('Button should now be visible');
      }
    };

    console.log('Simple debug functions loaded. Try: debugCheck() or forceShowButton()');
  }, 500);
</script>

</body>
</html>